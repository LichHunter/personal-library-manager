{"original_content": "Success/failure events published back to Kafka ``` **Event Schema**: ```json { \"event_id\": \"uuid-v4\", \"event_type\": \"workflow.execution.completed\", \"timestamp\": \"2026-01-15T10:30:00.000Z\", \"correlation_id\": \"request-trace-id\", \"payload\": { \"workflow_id\": \"wf-12345\", \"execution_id\": \"exec-67890\", \"status\": \"COMPLETED\", \"duration_ms\": 4230 }, \"metadata\": { \"source_service\": \"workflow-engine\", \"schema_version\": \"1.0\" } } ``` ### Inter-Service Communication Services communicate using two primary patterns: **Synchronous (gRPC)**: - Auth Service validation calls from API Gateway - User Service profile lookups - Low latency requirement (< 50ms) - Request-response pattern with circuit breaker **Asynchronous (Kafka)**: - Workflow execution events - Notification triggers - Audit log events - Eventual consistency acceptable --- ## Database Architecture ### PostgreSQL Primary Database **Cluster Configuration**: - Primary-replica setup with 1 primary + 2 read replicas - Instance type: db.r6g.2xlarge (8 vCPU, 64GB RAM) - Storage: 2TB gp3 SSD with 12,000 IOPS - Multi-AZ deployment for high availability - Automated backups: Daily snapshots, 30-day retention - Point-in-time recovery: 5-minute granularity **Database Schema Design**: ``` Core Tables: - users (5M rows): User accounts and profiles - workflows (2M rows): Workflow definitions - workflow_executions (500M rows, partitioned): Execution history - workflow_steps (2B rows, partitioned): Individual step records - schedules (100K rows): Scheduled workflow triggers - notifications (1B rows, partitioned): Notification delivery log Partitioning Strategy: - workflow_executions: Monthly partitions by created_at - workflow_steps: Monthly partitions by created_at - notifications: Weekly partitions by created_at - Automatic partition creation via cron job - Retention policy: Drop partitions older than 12 months ``` **Indexing Strategy**: - Primary keys: UUIDs with B-tree indexes - Frequently queried columns: Compound indexes (e.g., user_id + status + created_at) - JSONB columns: GIN indexes for workflow definitions - Full-text search: GiST indexes on description fields **Connection Pooling**: - PgBouncer in transaction mode - Pool size: 100 connections per service - Max client connections: 2000 - Connection timeout: 30 seconds **Performance Characteristics**: - Read query P99: < 20ms - Write query P99: < 50ms - Transaction throughput: 15,000 TPS - Replication lag: < 500ms --- ### Redis Caching Layer **Cluster Configuration**: - Redis Cluster with 6 nodes (3 primary + 3 replica) - Instance type: cache.r6g.xlarge (4 vCPU, 26GB RAM) - Total memory: 78GB usable cache space - Persistence: RDB snapshots every 5 minutes + AOF - Eviction policy: allkeys-lru **Cache Usage Patterns**: 1.", "enhanced_content": "Monthly partitions, Indexing Strategy, Core Tables, Performance Characteristics, Partitioning Strategy, Redis Caching, Redis Cluster | Success, created_at - Automatic, Kafka, Drop, correlation_id\n\nSuccess/failure events published back to Kafka ``` **Event Schema**: ```json { \"event_id\": \"uuid-v4\", \"event_type\": \"workflow.execution.completed\", \"timestamp\": \"2026-01-15T10:30:00.000Z\", \"correlation_id\": \"request-trace-id\", \"payload\": { \"workflow_id\": \"wf-12345\", \"execution_id\": \"exec-67890\", \"status\": \"COMPLETED\", \"duration_ms\": 4230 }, \"metadata\": { \"source_service\": \"workflow-engine\", \"schema_version\": \"1.0\" } } ``` ### Inter-Service Communication Services communicate using two primary patterns: **Synchronous (gRPC)**: - Auth Service validation calls from API Gateway - User Service profile lookups - Low latency requirement (< 50ms) - Request-response pattern with circuit breaker **Asynchronous (Kafka)**: - Workflow execution events - Notification triggers - Audit log events - Eventual consistency acceptable --- ## Database Architecture ### PostgreSQL Primary Database **Cluster Configuration**: - Primary-replica setup with 1 primary + 2 read replicas - Instance type: db.r6g.2xlarge (8 vCPU, 64GB RAM) - Storage: 2TB gp3 SSD with 12,000 IOPS - Multi-AZ deployment for high availability - Automated backups: Daily snapshots, 30-day retention - Point-in-time recovery: 5-minute granularity **Database Schema Design**: ``` Core Tables: - users (5M rows): User accounts and profiles - workflows (2M rows): Workflow definitions - workflow_executions (500M rows, partitioned): Execution history - workflow_steps (2B rows, partitioned): Individual step records - schedules (100K rows): Scheduled workflow triggers - notifications (1B rows, partitioned): Notification delivery log Partitioning Strategy: - workflow_executions: Monthly partitions by created_at - workflow_steps: Monthly partitions by created_at - notifications: Weekly partitions by created_at - Automatic partition creation via cron job - Retention policy: Drop partitions older than 12 months ``` **Indexing Strategy**: - Primary keys: UUIDs with B-tree indexes - Frequently queried columns: Compound indexes (e.g., user_id + status + created_at) - JSONB columns: GIN indexes for workflow definitions - Full-text search: GiST indexes on description fields **Connection Pooling**: - PgBouncer in transaction mode - Pool size: 100 connections per service - Max client connections: 2000 - Connection timeout: 30 seconds **Performance Characteristics**: - Read query P99: < 20ms - Write query P99: < 50ms - Transaction throughput: 15,000 TPS - Replication lag: < 500ms --- ### Redis Caching Layer **Cluster Configuration**: - Redis Cluster with 6 nodes (3 primary + 3 replica) - Instance type: cache.r6g.xlarge (4 vCPU, 26GB RAM) - Total memory: 78GB usable cache space - Persistence: RDB snapshots every 5 minutes + AOF - Eviction policy: allkeys-lru **Cache Usage Patterns**: 1.", "enrichment_type": "fast", "metadata": {"code_ratio": 0.31, "processing_time_ms": 68.81, "keyword_count": 10, "entity_count": 11}, "keywords": ["Monthly partitions", "Indexing Strategy", "Core Tables", "Performance Characteristics", "Partitioning Strategy", "Redis Caching", "Redis Cluster", "Caching Layer", "Usage Patterns", "Cluster Configuration"], "questions": [], "summary": "", "entities": {"ORG": ["Success", "created_at - Automatic", "P99", "TPS - Replication", "RAM"], "PERSON": ["Kafka", "Drop", "Redis Caching Layer"], "GPE": ["correlation_id", "GB"], "WORK_OF_ART": ["workflow_id"]}, "contextual_prefix": ""}