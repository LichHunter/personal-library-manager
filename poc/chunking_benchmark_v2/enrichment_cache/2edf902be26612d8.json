{"original_content": "Configure log aggregation: ```bash # Install Fluent Bit for log forwarding helm install fluent-bit fluent/fluent-bit \\ --namespace logging \\ --create-namespace \\ --set cloudWatch.enabled=true \\ --set cloudWatch.region=us-east-1 \\ --set cloudWatch.logGroupName=/aws/eks/cloudflow-production/application ``` Query logs using CloudWatch Insights: ```sql fields @timestamp, @message, level, requestId, userId | filter namespace = \"cloudflow-prod\" | filter level = \"error\" | sort @timestamp desc | limit 100 ``` --- ## Backup and Disaster Recovery ### Database Backup Strategy CloudFlow implements a comprehensive backup strategy with the following retention policy: - **Daily snapshots**: Retained for 30 days - **Weekly backups**: Retained for 90 days - **Monthly backups**: Retained for 1 year #### Automated Backup with Velero Install Velero for cluster-wide backups: ```bash velero install \\ --provider aws \\ --plugins velero/velero-plugin-for-aws:v1.8.0 \\ --bucket cloudflow-velero-backups \\ --backup-location-config region=us-east-1 \\ --snapshot-location-config region=us-east-1 \\ --secret-file ./credentials-velero ``` Create a daily backup schedule: ```yaml # backup-schedule.yaml apiVersion: velero.io/v1 kind: Schedule metadata: name: cloudflow-daily-backup namespace: velero spec: schedule: \"0 2 * * *\" # 2 AM UTC daily template: includedNamespaces: - cloudflow-prod ttl: 720h0m0s # 30 days storageLocation: default snapshotVolumes: true ``` Apply the backup schedule: ```bash kubectl apply -f backup-schedule.yaml ``` #### PostgreSQL Backup Configure PostgreSQL continuous archiving with WAL-G: ```bash # Create backup cronjob kubectl apply -f - <<EOF apiVersion: batch/v1 kind: CronJob metadata: name: postgres-backup namespace: cloudflow-prod spec: schedule: \"0 1 * * *\" # 1 AM UTC daily jobTemplate: spec: template: spec: containers: - name: backup image: postgres:14 env: - name: PGPASSWORD valueFrom: secretKeyRef: name: postgres-credentials key: password command: - /bin/bash - -c - | TIMESTAMP=\\$(date +%Y%m%d_%H%M%S) pg_dump -h postgresql.cloudflow-prod.svc.cluster.local \\ -U cloudflow -d cloudflow \\ | gzip > /backups/cloudflow_\\${TIMESTAMP}.sql.gz aws s3 cp /backups/cloudflow_\\${TIMESTAMP}.sql.gz \\ s3://cloudflow-db-backups/daily/ volumeMounts: - name: backup-storage mountPath: /backups volumes: - name: backup-storage emptyDir: {} restartPolicy: OnFailure EOF ``` ### Disaster Recovery Procedure In case of catastrophic failure, follow these steps to restore CloudFlow: 1. **Restore EKS Cluster** (if necessary): ```bash eksctl create cluster -f cluster-config.yaml ``` 2. **Restore Velero Backup**: ```bash # List available backups velero backup get # Restore from backup velero restore create --from-backup cloudflow-daily-backup-20260124 ``` 3. **Restore Database**: ```bash # Download backup from S3 aws s3 cp s3://cloudflow-db-backups/daily/cloudflow_20260124_010000.sql.gz . # Restore database gunzip -c cloudflow_20260124_010000.sql.gz | \\ psql -h postgresql.cloudflow-prod.svc.cluster.local -U cloudflow -d cloudflow ``` 4.", "enhanced_content": "Disaster Recovery, Recovery Procedure, Backup Strategy, Query logs, CloudWatch Insights, Velero Install, Install Velero | CloudWatch Insights, WAL, Backup, Automated Backup\n\nConfigure log aggregation: ```bash # Install Fluent Bit for log forwarding helm install fluent-bit fluent/fluent-bit \\ --namespace logging \\ --create-namespace \\ --set cloudWatch.enabled=true \\ --set cloudWatch.region=us-east-1 \\ --set cloudWatch.logGroupName=/aws/eks/cloudflow-production/application ``` Query logs using CloudWatch Insights: ```sql fields @timestamp, @message, level, requestId, userId | filter namespace = \"cloudflow-prod\" | filter level = \"error\" | sort @timestamp desc | limit 100 ``` --- ## Backup and Disaster Recovery ### Database Backup Strategy CloudFlow implements a comprehensive backup strategy with the following retention policy: - **Daily snapshots**: Retained for 30 days - **Weekly backups**: Retained for 90 days - **Monthly backups**: Retained for 1 year #### Automated Backup with Velero Install Velero for cluster-wide backups: ```bash velero install \\ --provider aws \\ --plugins velero/velero-plugin-for-aws:v1.8.0 \\ --bucket cloudflow-velero-backups \\ --backup-location-config region=us-east-1 \\ --snapshot-location-config region=us-east-1 \\ --secret-file ./credentials-velero ``` Create a daily backup schedule: ```yaml # backup-schedule.yaml apiVersion: velero.io/v1 kind: Schedule metadata: name: cloudflow-daily-backup namespace: velero spec: schedule: \"0 2 * * *\" # 2 AM UTC daily template: includedNamespaces: - cloudflow-prod ttl: 720h0m0s # 30 days storageLocation: default snapshotVolumes: true ``` Apply the backup schedule: ```bash kubectl apply -f backup-schedule.yaml ``` #### PostgreSQL Backup Configure PostgreSQL continuous archiving with WAL-G: ```bash # Create backup cronjob kubectl apply -f - <<EOF apiVersion: batch/v1 kind: CronJob metadata: name: postgres-backup namespace: cloudflow-prod spec: schedule: \"0 1 * * *\" # 1 AM UTC daily jobTemplate: spec: template: spec: containers: - name: backup image: postgres:14 env: - name: PGPASSWORD valueFrom: secretKeyRef: name: postgres-credentials key: password command: - /bin/bash - -c - | TIMESTAMP=\\$(date +%Y%m%d_%H%M%S) pg_dump -h postgresql.cloudflow-prod.svc.cluster.local \\ -U cloudflow -d cloudflow \\ | gzip > /backups/cloudflow_\\${TIMESTAMP}.sql.gz aws s3 cp /backups/cloudflow_\\${TIMESTAMP}.sql.gz \\ s3://cloudflow-db-backups/daily/ volumeMounts: - name: backup-storage mountPath: /backups volumes: - name: backup-storage emptyDir: {} restartPolicy: OnFailure EOF ``` ### Disaster Recovery Procedure In case of catastrophic failure, follow these steps to restore CloudFlow: 1. **Restore EKS Cluster** (if necessary): ```bash eksctl create cluster -f cluster-config.yaml ``` 2. **Restore Velero Backup**: ```bash # List available backups velero backup get # Restore from backup velero restore create --from-backup cloudflow-daily-backup-20260124 ``` 3. **Restore Database**: ```bash # Download backup from S3 aws s3 cp s3://cloudflow-db-backups/daily/cloudflow_20260124_010000.sql.gz . # Restore database gunzip -c cloudflow_20260124_010000.sql.gz | \\ psql -h postgresql.cloudflow-prod.svc.cluster.local -U cloudflow -d cloudflow ``` 4.", "enrichment_type": "fast", "metadata": {"code_ratio": 0.75, "processing_time_ms": 31.12, "keyword_count": 10, "entity_count": 5}, "keywords": ["Disaster Recovery", "Recovery Procedure", "Backup Strategy", "Query logs", "CloudWatch Insights", "Velero Install", "Install Velero", "Retained", "backup schedule", "Strategy CloudFlow"], "questions": [], "summary": "", "entities": {"ORG": ["CloudWatch Insights", "WAL"], "PERSON": ["Backup", "Automated Backup", "Velero Install Velero"]}, "contextual_prefix": ""}