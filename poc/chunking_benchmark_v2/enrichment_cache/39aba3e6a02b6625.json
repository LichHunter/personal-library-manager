{"original_content": "podSelector: matchLabels: app: cloudflow policyTypes: - Ingress - Egress ingress: - from: - namespaceSelector: matchLabels: name: cloudflow-prod - podSelector: matchLabels: app: nginx-ingress ports: - protocol: TCP port: 3000 egress: - to: - podSelector: matchLabels: app: postgresql ports: - protocol: TCP port: 5432 - to: - podSelector: matchLabels: app: redis ports: - protocol: TCP port: 6379 ``` ### Pod Security Standards Enforce Pod Security Standards at the namespace level: ```bash kubectl label namespace cloudflow-prod \\ pod-security.kubernetes.io/enforce=restricted \\ pod-security.kubernetes.io/audit=restricted \\ pod-security.kubernetes.io/warn=restricted ``` ### Secrets Management Use AWS Secrets Manager for sensitive credentials: ```bash # Install External Secrets Operator helm install external-secrets external-secrets/external-secrets \\ --namespace external-secrets-system \\ --create-namespace # Create SecretStore kubectl apply -f - <<EOF apiVersion: external-secrets.io/v1beta1 kind: SecretStore metadata: name: aws-secrets-manager namespace: cloudflow-prod spec: provider: aws: service: SecretsManager region: us-east-1 auth: jwt: serviceAccountRef: name: external-secrets-sa EOF ``` --- ## Troubleshooting ### Common Issues #### Pods in CrashLoopBackOff **Symptoms**: Pods continuously restart **Diagnosis**: ```bash kubectl logs -n cloudflow-prod <pod-name> --previous kubectl describe pod -n cloudflow-prod <pod-name> ``` **Common Causes**: - Database connection failure - Invalid environment variables - Insufficient resources #### High Memory Usage **Symptoms**: Pods being OOMKilled **Diagnosis**: ```bash kubectl top pods -n cloudflow-prod ``` **Resolution**: - Increase memory limits in deployment - Check for memory leaks in application logs - Review heap dump for Node.js processes #### Database Connection Pool Exhausted **Symptoms**: \"Too many connections\" errors **Diagnosis**: ```bash # Check PgBouncer stats kubectl exec -it pgbouncer-xxx -n cloudflow-prod -- \\ psql -p 5432 -U pgbouncer pgbouncer -c \"SHOW POOLS;\" ``` **Resolution**: - Increase `max_db_connections` in PgBouncer - Optimize application connection usage - Add more PostgreSQL replicas ### Support Contacts - **On-call Engineer**: pagerduty.com/cloudflow-oncall - **Slack Channel**: #cloudflow-operations - **Documentation**: https://docs.cloudflow.io - **Status Page**: https://status.cloudflow.io --- ## Appendix ### Useful Commands ```bash # View all resources in namespace kubectl get all -n cloudflow-prod # Check resource usage kubectl top pods -n cloudflow-prod kubectl top nodes # View logs kubectl logs -f deployment/cloudflow-api -n cloudflow-prod # Execute command in pod kubectl exec -it <pod-name> -n cloudflow-prod -- /bin/sh # Port forward for local testing kubectl port-forward svc/cloudflow-api 8080:80 -n cloudflow-prod # Rollback deployment helm rollback cloudflow -n cloudflow-prod # Update deployment helm upgrade cloudflow cloudflow/cloudflow \\ --namespace cloudflow-prod \\ --values values-production.yaml ``` ### Maintenance Windows Scheduled maintenance occurs during the following windows: - **Primary**: Sunday 02:00-06:00", "enhanced_content": "TCP port, SHOW POOLS, External Secrets, Secrets Operator, kubectl top, Egress ingress, bash kubectl | Install External Secrets Operator, EOF, Create SecretStore, external-secrets.io/v1beta1\n\npodSelector: matchLabels: app: cloudflow policyTypes: - Ingress - Egress ingress: - from: - namespaceSelector: matchLabels: name: cloudflow-prod - podSelector: matchLabels: app: nginx-ingress ports: - protocol: TCP port: 3000 egress: - to: - podSelector: matchLabels: app: postgresql ports: - protocol: TCP port: 5432 - to: - podSelector: matchLabels: app: redis ports: - protocol: TCP port: 6379 ``` ### Pod Security Standards Enforce Pod Security Standards at the namespace level: ```bash kubectl label namespace cloudflow-prod \\ pod-security.kubernetes.io/enforce=restricted \\ pod-security.kubernetes.io/audit=restricted \\ pod-security.kubernetes.io/warn=restricted ``` ### Secrets Management Use AWS Secrets Manager for sensitive credentials: ```bash # Install External Secrets Operator helm install external-secrets external-secrets/external-secrets \\ --namespace external-secrets-system \\ --create-namespace # Create SecretStore kubectl apply -f - <<EOF apiVersion: external-secrets.io/v1beta1 kind: SecretStore metadata: name: aws-secrets-manager namespace: cloudflow-prod spec: provider: aws: service: SecretsManager region: us-east-1 auth: jwt: serviceAccountRef: name: external-secrets-sa EOF ``` --- ## Troubleshooting ### Common Issues #### Pods in CrashLoopBackOff **Symptoms**: Pods continuously restart **Diagnosis**: ```bash kubectl logs -n cloudflow-prod <pod-name> --previous kubectl describe pod -n cloudflow-prod <pod-name> ``` **Common Causes**: - Database connection failure - Invalid environment variables - Insufficient resources #### High Memory Usage **Symptoms**: Pods being OOMKilled **Diagnosis**: ```bash kubectl top pods -n cloudflow-prod ``` **Resolution**: - Increase memory limits in deployment - Check for memory leaks in application logs - Review heap dump for Node.js processes #### Database Connection Pool Exhausted **Symptoms**: \"Too many connections\" errors **Diagnosis**: ```bash # Check PgBouncer stats kubectl exec -it pgbouncer-xxx -n cloudflow-prod -- \\ psql -p 5432 -U pgbouncer pgbouncer -c \"SHOW POOLS;\" ``` **Resolution**: - Increase `max_db_connections` in PgBouncer - Optimize application connection usage - Add more PostgreSQL replicas ### Support Contacts - **On-call Engineer**: pagerduty.com/cloudflow-oncall - **Slack Channel**: #cloudflow-operations - **Documentation**: https://docs.cloudflow.io - **Status Page**: https://status.cloudflow.io --- ## Appendix ### Useful Commands ```bash # View all resources in namespace kubectl get all -n cloudflow-prod # Check resource usage kubectl top pods -n cloudflow-prod kubectl top nodes # View logs kubectl logs -f deployment/cloudflow-api -n cloudflow-prod # Execute command in pod kubectl exec -it <pod-name> -n cloudflow-prod -- /bin/sh # Port forward for local testing kubectl port-forward svc/cloudflow-api 8080:80 -n cloudflow-prod # Rollback deployment helm rollback cloudflow -n cloudflow-prod # Update deployment helm upgrade cloudflow cloudflow/cloudflow \\ --namespace cloudflow-prod \\ --values values-production.yaml ``` ### Maintenance Windows Scheduled maintenance occurs during the following windows: - **Primary**: Sunday 02:00-06:00", "enrichment_type": "fast", "metadata": {"code_ratio": 0.36, "processing_time_ms": 59.07, "keyword_count": 10, "entity_count": 7}, "keywords": ["TCP port", "SHOW POOLS", "External Secrets", "Secrets Operator", "kubectl top", "Egress ingress", "bash kubectl", "Install External", "Windows Scheduled", "Scheduled maintenance"], "questions": [], "summary": "", "entities": {"ORG": ["Install External Secrets Operator", "EOF"], "PERSON": ["Create SecretStore", "external-secrets.io/v1beta1", "jwt", "Check PgBouncer", "View"]}, "contextual_prefix": ""}