# ADR-001: Use PostgreSQL for Primary Database

**Status:** Accepted
**Date:** 2024-11-04

## Context

We need a database to store workflow definitions, execution state, and user data. The database must support ACID transactions, JSON queries, and scale to millions of records.

## Options Considered

### Option 1: PostgreSQL

Mature relational database with JSONB support.

**Pros:**
- ACID compliance
- Rich JSONB queries
- Team expertise
- Proven at scale

**Cons:**
- Manual sharding for extreme scale
- Requires connection pooling

### Option 2: MongoDB

Document database with native JSON.

**Pros:**
- Flexible schema
- Built-in sharding
- Good for documents

**Cons:**
- Weaker consistency guarantees
- Complex transactions
- Higher operational cost

### Option 3: CockroachDB

Distributed SQL database.

**Pros:**
- Automatic sharding
- Strong consistency
- PostgreSQL compatible

**Cons:**
- Higher latency
- More expensive
- Less mature ecosystem

## Decision

We will use PostgreSQL as our primary database with JSONB for flexible workflow definitions.

## Consequences

- Need PgBouncer for connection pooling
- Must plan for sharding at 100M+ records
- Requires regular VACUUM maintenance